@page
@model HelloWorldWeb.Pages.AdminModel
@{
    Layout = null;
}

<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="utf-8" />
    <title>ğŸ”§ ×××©×§ × ×™×”×•×œ</title>
    <link rel="stylesheet" href="/css/site.css" />
    <style>
        body {
            background-color: #111;
            color: #fff;
            font-family: "Segoe UI", sans-serif;
            padding: 40px;
            direction: rtl;
            margin: 0;
        }
        
        body::before {
            content: '';
            position: fixed;
            inset: 0;
            background-image: 
                repeating-linear-gradient(
                    0deg,
                    transparent,
                    transparent 2px,
                    rgba(90, 169, 230, 0.03) 2px,
                    rgba(90, 169, 230, 0.03) 4px
                );
            pointer-events: none;
            z-index: 0;
        }
        h1 { font-size: 32px; margin-bottom: 20px; }
        h2 { margin-top: 40px; border-bottom: 2px solid #333; padding-bottom: 5px; color: #ffd700; }
        table {
            width: 100%; border-collapse: collapse; margin-top: 15px;
            background-color: #1e1e1e; border-radius: 10px; overflow: hidden;
        }
        th, td {
            padding: 12px; border-bottom: 1px solid #333; text-align: center;
        }
        th { background-color: #222; font-weight: bold; }
        tr:nth-child(even) { background-color: #191919; }
        ul li { margin: 8px 0; }
        ul strong { color: #1e90ff; }
        .back-to-quiz {
            display: inline-block; margin-top: 30px; padding: 10px 20px;
            background-color: #1e90ff; color: white; text-decoration: none;
            border-radius: 8px; font-weight: bold;
        }
        .back-to-quiz:hover { background-color: #0077cc; }
    </style>
</head>
<body>
    <!-- ×¨×§×¢ HTML ×‘×œ×‘×“ (×œ×œ× GIF) -->
    <iframe src="/logo/fsociety_matrix_blue.html" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -2; border: none; pointer-events: none; opacity: 0.1;"></iframe>
    
    <h1>ğŸ“Š ×××©×§ × ×™×”×•×œ - Dashboard</h1>

    @if (ViewData["SuccessMessage"] != null)
    {
        <div style="background-color:#28a428; padding:12px; border-radius:6px; margin:20px 0; color:white; font-weight:bold; text-align:center;">
            @ViewData["SuccessMessage"]
        </div>
    }

    <h2>âœ… ×¡×˜×˜×™×¡×˜×™×§×” ×›×œ×œ×™×ª</h2>
    <ul>
        <li>ğŸ‘¥ ××©×ª××©×™× ×¨×©×•××™×: <strong>@Model.AllUsers.Count</strong></li>
        <li>ğŸŸ¢ ××—×•×‘×¨×™× ×›×¨×’×¢: <strong>@Model.OnlineUsers.Count</strong></li>
        <li>ğŸš© ××¡×•×× ×™× ×›Ö¾Cheaters: <strong>@Model.Cheaters.Count</strong></li>
        <li>ğŸ”’ ×—×¡×•××™×: <strong>@Model.BannedUsers.Count</strong></li>
        <li>ğŸ“ˆ ×××•×¦×¢ ×”×¦×œ×—×”: <strong>@Model.AverageSuccessRate.ToString("0.0")%</strong></li>
    </ul>

    <h2>ğŸ“¶ ××©×ª××©×™× ××—×•×‘×¨×™× ×›×¨×’×¢</h2>
    <table>
        <tr><th>×©× ××©×ª××©</th></tr>
        @foreach (var user in Model.OnlineUsers)
        {
            <tr>
                <td>@user.Username</td>
            </tr>
        }
    </table>

    <h2>ğŸ† ×˜×‘×œ×ª ××•×‘×™×œ×™×</h2>
    <table>
        <tr>
            <th>××™×§×•×</th>
            <th>×©× ××©×ª××©</th>
            <th>× ×¢× ×•</th>
            <th>× ×›×•× ×•×ª</th>
            <th>×”×¦×œ×—×”</th>
        </tr>
        @for (int i = 0; i < Model.TopUsers.Count; i++)
        {
            var user = Model.TopUsers[i];
            <tr>
                <td>@(i + 1)</td>
                <td>@user.Username</td>
                <td>@user.TotalAnswered</td>
                <td>@user.CorrectAnswers</td>
                <td>@(user.TotalAnswered > 0 ? ((double)user.CorrectAnswers / user.TotalAnswered).ToString("0%") : "N/A")</td>
            </tr>
        }
    </table>

    <h2>ğŸš¨ Cheaters</h2>
    <table>
        <tr><th>×©× ××©×ª××©</th><th>× ×¢× ×•</th><th>× ×›×•× ×•×ª</th><th>×”×¦×œ×—×”</th></tr>
        @foreach (var user in Model.Cheaters)
        {
            <tr>
                <td>@user.Username</td>
                <td>@user.TotalAnswered</td>
                <td>@user.CorrectAnswers</td>
                <td>@(user.TotalAnswered > 0 ? ((double)user.CorrectAnswers / user.TotalAnswered).ToString("0%") : "N/A")</td>
            </tr>
        }
    </table>

    <h2>ğŸ”’ ×—×¡×•××™×</h2>
    <table>
        <tr><th>×©× ××©×ª××©</th><th>× ×¢× ×•</th><th>× ×›×•× ×•×ª</th><th>×”×¦×œ×—×”</th></tr>
        @foreach (var user in Model.BannedUsers)
        {
            <tr>
                <td>@user.Username</td>
                <td>@user.TotalAnswered</td>
                <td>@user.CorrectAnswers</td>
                <td>@(user.TotalAnswered > 0 ? ((double)user.CorrectAnswers / user.TotalAnswered).ToString("0%") : "N/A")</td>
            </tr>
        }
    </table>

    <h2>ğŸ¯ ××¢×¨×›×ª ×“×™×¨×•×’ ×§×•×©×™ ×©××œ×•×ª</h2>
    <table>
        <tr>
            <th>ID ×©××œ×”</th>
            <th>×¨××ª ×§×•×©×™</th>
            <th>× ×¢× ×ª×”</th>
            <th>×ª×©×•×‘×•×ª × ×›×•× ×•×ª</th>
            <th>××—×•×– ×”×¦×œ×—×”</th>
            <th>×¢×•×“×›×Ÿ ×‘</th>
        </tr>
        @if (Model.QuestionDifficulties != null && Model.QuestionDifficulties.Any())
        {
            @foreach (var q in Model.QuestionDifficulties.OrderByDescending(q => q.LastUpdated).Take(50))
            {
                var successRate = q.TotalAttempts > 0 ? (double)q.CorrectAttempts / q.TotalAttempts * 100 : 0;
                var difficultyColor = q.Difficulty switch
                {
                    "easy" => "#4caf50",
                    "medium" => "#ff9800",
                    "hard" => "#f44336",
                    _ => "#999"
                };
                var difficultyText = q.Difficulty switch
                {
                    "easy" => "×§×œ",
                    "medium" => "×‘×™× ×•× ×™",
                    "hard" => "×§×©×”",
                    _ => "×œ× ×™×“×•×¢"
                };
                <tr>
                    <td><a href="/QuestionView?id=@q.QuestionFile" style="color: #1e90ff; text-decoration: none;" target="_blank">@q.QuestionFile</a></td>
                    <td style="color: @difficultyColor; font-weight: bold;">@difficultyText</td>
                    <td>@q.TotalAttempts</td>
                    <td>@q.CorrectAttempts</td>
                    <td>@successRate.ToString("0.0")%</td>
                    <td style="font-size: 11px; color: #888;">@q.LastUpdated.ToLocalTime().ToString("dd/MM HH:mm")</td>
                </tr>
            }
        }
        else
        {
            <tr><td colspan="6" style="text-align: center; color: #888;">××™×Ÿ × ×ª×•× ×™× ×¢×“×™×™×Ÿ</td></tr>
        }
    </table>

    <div style="margin-top: 40px; display: flex; gap: 15px; flex-wrap: wrap; justify-content: center;">
        <a href="/Index" class="back-to-quiz">â¬… ×—×–×¨×” ×œ×—×™×“×•×Ÿ</a>
        <a href="/Test?start=1" class="back-to-quiz" style="background-color: #28a745;">ğŸ§ª ××‘×—×Ÿ ×—×“×©</a>
        <a href="/MyExams" class="back-to-quiz" style="background-color: #6c757d;">ğŸ“š ×”××‘×—× ×™× ×©×œ×™</a>
        <a href="/StorageDebug" class="back-to-quiz" style="background-color: #ff6b6b;">ğŸ” Storage Debug</a>
    </div>
</body>
</html>
