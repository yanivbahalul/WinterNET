@page
@model HelloWorldWeb.Pages.ManageExplanationsModel
@{
    Layout = null;
}

<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="utf-8" />
    <title>WinterNET â€” ×”×¡×‘×¨×™× ×œ×©××œ×•×ª</title>
    <link rel="stylesheet" href="/css/site.css" />
    <style>
        body {
            background-color: #111;
            color: #fff;
            font-family: "Segoe UI", sans-serif;
            padding: 40px;
            direction: rtl;
        }
        h1 { font-size: 32px; margin-bottom: 20px; color: #ffd700; }
        h2 { margin-top: 40px; border-bottom: 2px solid #333; padding-bottom: 5px; color: #4caf50; }
        p { line-height: 1.7; }
        .stats-box { display: flex; gap: 30px; margin: 20px 0; flex-wrap: wrap; }
        .stat-item { background: #1e1e1e; padding: 20px; border-radius: 10px; flex: 1 1 180px; text-align: center; border: 2px solid #333; }
        .stat-number { font-size: 30px; font-weight: bold; color: #4caf50; }
        .stat-label { margin-top: 6px; color: #bbb; font-size: 14px; }
        .search-box { margin: 20px 0; padding: 15px; background: #1e1e1e; border-radius: 10px; border: 2px solid #333; }
        .search-box input { width: 100%; padding: 12px; font-size: 16px; border: 2px solid #444; border-radius: 6px; background: #222; color: #fff; font-family: 'Courier New', monospace; }
        .search-box input:focus { outline: none; border-color: #4caf50; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; background-color: #1e1e1e; border-radius: 10px; overflow: hidden; }
        th, td { padding: 12px; border-bottom: 1px solid #333; }
        th { background-color: #222; font-weight: bold; text-align: center; }
        tr:nth-child(even) { background-color: #191919; }
        tr:hover { background-color: #252525; }
        .has-explanation { color: #4caf50; font-weight: bold; }
        .no-explanation { color: #999; }
        .btn-back { background: #1e90ff; color: white; text-decoration: none; padding: 10px 20px; display: inline-block; margin-bottom: 20px; border-radius: 6px; }
        .btn-back:hover { background: #0077cc; }
        pre { direction: ltr; background: #101010; padding: 12px; border-radius: 8px; border: 1px solid #333; color: #f0f0f0; overflow-x: auto; font-size: 13px; }
        code { font-family: 'Courier New', monospace; }
        .info-box { background: rgba(76, 175, 80, 0.12); border: 1px solid rgba(76, 175, 80, 0.35); padding: 20px; border-radius: 10px; color: #c8f0c8; margin-bottom: 30px; }
        .info-box strong { color: #4caf50; }
        .background-gif { position: fixed; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; opacity: 0.05; z-index: -1; }
        .filter-buttons { margin: 15px 0; display: flex; gap: 10px; flex-wrap: wrap; }
        .filter-btn { padding: 10px 18px; border: 2px solid #444; background: #222; color: #fff; border-radius: 6px; cursor: pointer; font-weight: bold; transition: all 0.2s; }
        .filter-btn.active { background: #4caf50; border-color: #4caf50; }
        .filter-btn:hover { background: #333; }
        td.explanation-cell { text-align: right; font-size: 13px; color: #ccc; white-space: pre-wrap; }
    </style>
</head>
<body>
    <img src="/assets/background.gif" class="background-gif" alt="×¨×§×¢" />
    <a href="/Admin" class="btn-back">â¬… ×—×–×¨×” ×œ× ×™×”×•×œ</a>

    <h1>ğŸ“ ×”×¡×‘×¨×™× ×œ×©××œ×•×ª (×§×¨×™××” ×‘×œ×‘×“)</h1>

    <div class="info-box">
        <strong>××™×š ××•×¡×™×¤×™× ××• ××¢×“×›× ×™× ×”×¡×‘×¨?</strong>
        <p>
            ×¢×“×›×•×Ÿ ×”×”×¡×‘×¨×™× ××ª×‘×¦×¢ ×™×©×™×¨×•×ª ×‘×˜×‘×œ×” <code>question_explanations</code> ×‘-Supabase. ×”×§×¤×“ ×©×”×©× ×‘×¢××•×“×ª <code>questionfile</code> ×™×”×™×” ×–×”×” ×œ×—×œ×•×˜×™×Ÿ ×œ×©× ×§×•×‘×¥ ×”×©××œ×” (×›×•×œ×œ ×”×¡×™×•××ª, ×œ×œ× ×¨×•×•×—×™× ××• ×˜××‘×™×).
        </p>
        <p>×“×•×’××” ×œ×©××™×œ×ª×” (SQL Editor):</p>
        <pre>insert into question_explanations (questionfile, explanation)
values ('Screenshot at Nov 05 21-59-18.png', '×”×”×¡×‘×¨ ×›××Ÿ...')
on conflict (questionfile)
do update set explanation = excluded.explanation,
              updatedat = timezone('utc', now());</pre>
        <p style="font-size: 14px; color: #b0d5b0;">
            × ×™×ª×Ÿ ×œ×”×©×ª××© ×‘××¢×‘×¨×™ ×©×•×¨×” ×‘×˜×§×¡×˜ ×”×”×¡×‘×¨. <code>createdat</code> ×•-<code>updatedat</code> ××ª×¢×“×›× ×™× ××•×˜×•××˜×™×ª.
        </p>
    </div>

    <h2>×›×™×¡×•×™ × ×•×›×—×™</h2>
    <div class="stats-box">
        <div class="stat-item">
            <div class="stat-number">@Model.TotalQuestions</div>
            <div class="stat-label">×¡×”"×› ×©××œ×•×ª</div>
        </div>
        <div class="stat-item">
            <div class="stat-number">@Model.QuestionsWithExplanations</div>
            <div class="stat-label">×¢× ×”×¡×‘×¨</div>
        </div>
        <div class="stat-item">
            <div class="stat-number">@(Model.TotalQuestions - Model.QuestionsWithExplanations)</div>
            <div class="stat-label">×œ×œ× ×”×¡×‘×¨</div>
        </div>
        <div class="stat-item">
            <div class="stat-number">@(Model.TotalQuestions > 0 ? ((double)Model.QuestionsWithExplanations / Model.TotalQuestions * 100).ToString("F1") : "0")%</div>
            <div class="stat-label">××—×•×– ×›×™×¡×•×™</div>
        </div>
    </div>

    <div class="filter-buttons">
        <button class="filter-btn active" data-filter="all" onclick="filterQuestions(event, 'all')">×”×›×œ (@Model.TotalQuestions)</button>
        <button class="filter-btn" data-filter="with" onclick="filterQuestions(event, 'with')">×¢× ×”×¡×‘×¨ (@Model.QuestionsWithExplanations)</button>
        <button class="filter-btn" data-filter="without" onclick="filterQuestions(event, 'without')">×œ×œ× ×”×¡×‘×¨ (@(Model.TotalQuestions - Model.QuestionsWithExplanations))</button>
    </div>

    <div class="search-box">
        <input type="text" id="searchInput" placeholder="ğŸ” ×—×™×¤×•×© ×©× ×§×•×‘×¥..." onkeyup="searchQuestions()">
    </div>

    <table id="questionsTable">
        <thead>
            <tr>
                <th style="width: 50px;">#</th>
                <th style="text-align: right;">×©× ×§×•×‘×¥</th>
                <th style="width: 140px;">×¡×˜×˜×•×¡</th>
                <th style="text-align: right;">×”×¡×‘×¨</th>
            </tr>
        </thead>
        <tbody>
            @for (int i = 0; i < Model.Questions.Count; i++)
            {
                var q = Model.Questions[i];
                var hasExp = q.HasExplanation;
                <tr class="question-row" data-has-explanation="@hasExp.ToString().ToLower()">
                    <td style="text-align: center; color: #666;">@(i + 1)</td>
                    <td style="text-align: right; font-family: 'Courier New', monospace;">@q.QuestionFile</td>
                    <td style="text-align: center;">
                        @if (hasExp)
                        {
                            <span class="has-explanation">âœ“ ×™×© ×”×¡×‘×¨</span>
                        }
                        else
                        {
                            <span class="no-explanation">âœ— ××™×Ÿ ×”×¡×‘×¨</span>
                        }
                    </td>
                    <td class="explanation-cell">
                        @if (hasExp)
                        {
                            @q.Explanation
                        }
                        else
                        {
                            <span style="color: #555; font-style: italic;">â€”</span>
                        }
                    </td>
                </tr>
            }
        </tbody>
    </table>

    <script>
        function searchQuestions() {
            var input = document.getElementById('searchInput');
            var filter = input.value.toLowerCase();
            var rows = document.getElementsByClassName('question-row');

            for (var i = 0; i < rows.length; i++) {
                var row = rows[i];
                var text = row.textContent || row.innerText;
                row.style.display = text.toLowerCase().indexOf(filter) > -1 ? '' : 'none';
            }
        }

        function filterQuestions(event, filter) {
            var buttons = document.getElementsByClassName('filter-btn');
            for (var i = 0; i < buttons.length; i++) {
                buttons[i].classList.remove('active');
            }
            event.target.classList.add('active');

            var rows = document.getElementsByClassName('question-row');
            for (var i = 0; i < rows.length; i++) {
                var row = rows[i];
                var hasExplanation = row.getAttribute('data-has-explanation') === 'true';

                var show = filter === 'all' ||
                    (filter === 'with' && hasExplanation) ||
                    (filter === 'without' && !hasExplanation);

                row.style.display = show ? '' : 'none';
            }
        }
    </script>
</body>
</html>

