@page
@model HelloWorldWeb.Pages.ManageExplanationsModel
@{
    Layout = null;
}

<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="utf-8" />
    <title>WinterNET â€” × ×™×”×•×œ ×”×¡×‘×¨×™×</title>
    <link rel="stylesheet" href="/css/site.css" />
    <style>
        body {
            background-color: #111;
            color: #fff;
            font-family: "Segoe UI", sans-serif;
            padding: 40px;
            direction: rtl;
        }
        
        h1 { 
            font-size: 32px; 
            margin-bottom: 20px; 
            color: #ffd700;
        }
        
        h2 { 
            margin-top: 40px; 
            border-bottom: 2px solid #333; 
            padding-bottom: 5px; 
            color: #4caf50; 
        }
        
        .stats-box {
            display: flex;
            gap: 30px;
            margin: 20px 0;
        }
        
        .stat-item {
            background: #1e1e1e;
            padding: 20px;
            border-radius: 10px;
            flex: 1;
            text-align: center;
            border: 2px solid #333;
        }
        
        .stat-number {
            font-size: 36px;
            font-weight: bold;
            color: #4caf50;
        }
        
        .stat-label {
            margin-top: 5px;
            color: #999;
        }
        
        .search-box {
            margin: 20px 0;
            padding: 15px;
            background: #1e1e1e;
            border-radius: 10px;
            border: 2px solid #333;
        }
        
        .search-box input {
            width: 100%;
            padding: 12px;
            font-size: 16px;
            border: 2px solid #444;
            border-radius: 6px;
            background: #222;
            color: #fff;
            font-family: 'Courier New', monospace;
        }
        
        .search-box input:focus {
            outline: none;
            border-color: #4caf50;
        }
        
        table {
            width: 100%; 
            border-collapse: collapse; 
            margin-top: 15px;
            background-color: #1e1e1e; 
            border-radius: 10px; 
            overflow: hidden;
        }
        
        th, td {
            padding: 12px; 
            border-bottom: 1px solid #333;
        }
        
        th { 
            background-color: #222; 
            font-weight: bold;
            text-align: center;
        }
        
        tr:nth-child(even) { background-color: #191919; }
        tr:hover { background-color: #252525; }
        
        .has-explanation {
            color: #4caf50;
            font-weight: bold;
        }
        
        .no-explanation {
            color: #999;
        }
        
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
            margin: 0 5px;
        }
        
        .btn-edit {
            background: #2196F3;
            color: white;
        }
        
        .btn-edit:hover {
            background: #1976D2;
        }
        
        .btn-delete {
            background: #f44336;
            color: white;
        }
        
        .btn-delete:hover {
            background: #d32f2f;
        }
        
        .btn-view {
            background: #4caf50;
            color: white;
            text-decoration: none;
        }
        
        .btn-view:hover {
            background: #45a049;
        }
        
        .btn-back {
            background: #1e90ff;
            color: white;
            text-decoration: none;
            padding: 10px 20px;
            display: inline-block;
            margin-bottom: 20px;
        }
        
        .btn-back:hover {
            background: #0077cc;
        }
        
        .message {
            padding: 15px;
            border-radius: 6px;
            margin: 20px 0;
            font-weight: bold;
            text-align: center;
        }
        
        .success-message {
            background-color: #28a428;
            color: white;
        }
        
        .error-message {
            background-color: #d32f2f;
            color: white;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.8);
        }
        
        .modal-content {
            background-color: #1e1e1e;
            margin: 5% auto;
            padding: 30px;
            border: 2px solid #4caf50;
            border-radius: 10px;
            width: 80%;
            max-width: 800px;
            color: white;
        }
        
        .close {
            color: #aaa;
            float: left;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .close:hover,
        .close:focus {
            color: #fff;
        }
        
        textarea {
            width: 100%;
            min-height: 150px;
            padding: 15px;
            font-size: 16px;
            border: 2px solid #444;
            border-radius: 6px;
            background: #222;
            color: #fff;
            font-family: 'Courier New', monospace;
            resize: vertical;
        }
        
        textarea:focus {
            outline: none;
            border-color: #4caf50;
        }
        
        .form-group {
            margin: 20px 0;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #4caf50;
        }
        
        .background-gif {
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%;
            object-fit: cover; 
            opacity: 0.05; 
            z-index: -1;
        }
        
        .filter-buttons {
            margin: 20px 0;
            text-align: center;
        }
        
        .filter-btn {
            padding: 10px 20px;
            margin: 0 5px;
            border: 2px solid #444;
            background: #222;
            color: #fff;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .filter-btn.active {
            background: #4caf50;
            border-color: #4caf50;
        }
        
        .filter-btn:hover {
            background: #333;
        }
    </style>
</head>
<body>
    <img src="/assets/background.gif" class="background-gif" alt="×¨×§×¢" />
    
    <a href="/Admin" class="btn btn-back">â¬… ×—×–×¨×” ×œ× ×™×”×•×œ</a>
    
    <h1>ğŸ“ × ×™×”×•×œ ×”×¡×‘×¨×™× ×œ×©××œ×•×ª</h1>

    @if (TempData["SuccessMessage"] != null)
    {
        <div class="message success-message">
            @TempData["SuccessMessage"]
        </div>
    }

    @if (TempData["ErrorMessage"] != null)
    {
        <div class="message error-message">
            @TempData["ErrorMessage"]
        </div>
    }

    <div class="stats-box">
        <div class="stat-item">
            <div class="stat-number">@Model.TotalQuestions</div>
            <div class="stat-label">×¡×”"×› ×©××œ×•×ª</div>
        </div>
        <div class="stat-item">
            <div class="stat-number">@Model.QuestionsWithExplanations</div>
            <div class="stat-label">×¢× ×”×¡×‘×¨</div>
        </div>
        <div class="stat-item">
            <div class="stat-number">@(Model.TotalQuestions - Model.QuestionsWithExplanations)</div>
            <div class="stat-label">×œ×œ× ×”×¡×‘×¨</div>
        </div>
        <div class="stat-item">
            <div class="stat-number">@(Model.TotalQuestions > 0 ? ((double)Model.QuestionsWithExplanations / Model.TotalQuestions * 100).ToString("F1") : "0")%</div>
            <div class="stat-label">××—×•×– ×›×™×¡×•×™</div>
        </div>
    </div>

    <div class="filter-buttons">
        <button class="filter-btn active" onclick="filterQuestions('all')">×”×›×œ (@Model.TotalQuestions)</button>
        <button class="filter-btn" onclick="filterQuestions('with')">×¢× ×”×¡×‘×¨ (@Model.QuestionsWithExplanations)</button>
        <button class="filter-btn" onclick="filterQuestions('without')">×œ×œ× ×”×¡×‘×¨ (@(Model.TotalQuestions - Model.QuestionsWithExplanations))</button>
    </div>

    <div class="search-box">
        <input type="text" id="searchInput" placeholder="ğŸ” ×—×™×¤×•×© ×©××œ×”..." onkeyup="searchQuestions()">
    </div>

    <h2>×¨×©×™××ª ×©××œ×•×ª</h2>
    <table id="questionsTable">
        <thead>
            <tr>
                <th style="width: 50px;">#</th>
                <th style="text-align: right;">×©× ×§×•×‘×¥</th>
                <th style="width: 120px;">×¡×˜×˜×•×¡</th>
                <th style="width: 250px;">×¤×¢×•×œ×•×ª</th>
            </tr>
        </thead>
        <tbody>
            @for (int i = 0; i < Model.Questions.Count; i++)
            {
                var q = Model.Questions[i];
                var hasExp = q.HasExplanation;
                <tr class="question-row" data-has-explanation="@hasExp.ToString().ToLower()">
                    <td style="text-align: center; color: #666;">@(i + 1)</td>
                    <td style="text-align: right; font-family: 'Courier New', monospace;">@q.QuestionFile</td>
                    <td style="text-align: center;">
                        @if (hasExp)
                        {
                            <span class="has-explanation">âœ“ ×™×© ×”×¡×‘×¨</span>
                        }
                        else
                        {
                            <span class="no-explanation">âœ— ××™×Ÿ ×”×¡×‘×¨</span>
                        }
                    </td>
                    <td style="text-align: center;">
                        <a href="/QuestionView?id=@Uri.EscapeDataString(q.QuestionFile)" target="_blank" class="btn btn-view">ğŸ” ×¦×¤×™×™×”</a>
                        <button class="btn btn-edit" onclick="openEditModal('@q.QuestionFile', '@(q.Explanation?.Replace("\\", "\\\\").Replace("'", "\\'").Replace("\r", "").Replace("\n", "\\n") ?? "")')">âœï¸ ×¢×¨×™×›×”</button>
                        @if (hasExp)
                        {
                            <button class="btn btn-delete" onclick="confirmDelete('@q.QuestionFile')">ğŸ—‘ï¸ ××—×™×§×”</button>
                        }
                    </td>
                </tr>
            }
        </tbody>
    </table>

    <!-- Edit Modal -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeEditModal()">&times;</span>
            <h2 style="border: none; margin-top: 0;">×¢×¨×™×›×ª ×”×¡×‘×¨</h2>
            <form method="post" asp-page-handler="Save">
                @Html.AntiForgeryToken()
                <div class="form-group">
                    <label>×©××œ×”:</label>
                    <input type="text" id="modalQuestionFile" name="QuestionFile" readonly 
                           style="background: #333; border: 2px solid #555; padding: 10px; width: 100%; border-radius: 6px; color: #fff; font-family: 'Courier New', monospace;">
                </div>
                <div class="form-group">
                    <label>×”×¡×‘×¨:</label>
                    <textarea id="modalExplanation" name="Explanation" placeholder="×”×–×Ÿ ×›××Ÿ ××ª ×”×”×¡×‘×¨ ×œ×©××œ×”..."></textarea>
                </div>
                <div style="text-align: center; margin-top: 30px;">
                    <button type="submit" class="btn btn-edit" style="font-size: 18px; padding: 12px 30px;">ğŸ’¾ ×©××•×¨</button>
                    <button type="button" class="btn" style="background: #666;" onclick="closeEditModal()">×‘×™×˜×•×œ</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Delete Form (hidden) -->
    <form id="deleteForm" method="post" asp-page-handler="Delete" style="display: none;">
        @Html.AntiForgeryToken()
        <input type="hidden" id="deleteQuestionFile" name="QuestionFile">
    </form>

    <script>
        function openEditModal(questionFile, explanation) {
            document.getElementById('modalQuestionFile').value = questionFile;
            document.getElementById('modalExplanation').value = explanation.replace(/\\n/g, '\n').replace(/\\'/g, "'");
            document.getElementById('editModal').style.display = 'block';
        }

        function closeEditModal() {
            document.getElementById('editModal').style.display = 'none';
        }

        function confirmDelete(questionFile) {
            if (confirm('×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ××ª ×”×”×¡×‘×¨ ×œ×©××œ×”: ' + questionFile + '?')) {
                document.getElementById('deleteQuestionFile').value = questionFile;
                document.getElementById('deleteForm').submit();
            }
        }

        function searchQuestions() {
            var input = document.getElementById('searchInput');
            var filter = input.value.toLowerCase();
            var table = document.getElementById('questionsTable');
            var rows = table.getElementsByClassName('question-row');

            for (var i = 0; i < rows.length; i++) {
                var row = rows[i];
                var text = row.textContent || row.innerText;
                if (text.toLowerCase().indexOf(filter) > -1) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            }
        }

        var currentFilter = 'all';

        function filterQuestions(filter) {
            currentFilter = filter;
            var rows = document.getElementsByClassName('question-row');
            
            // Update button states
            var buttons = document.getElementsByClassName('filter-btn');
            for (var i = 0; i < buttons.length; i++) {
                buttons[i].classList.remove('active');
            }
            event.target.classList.add('active');
            
            // Filter rows
            for (var i = 0; i < rows.length; i++) {
                var row = rows[i];
                var hasExplanation = row.getAttribute('data-has-explanation') === 'true';
                
                if (filter === 'all') {
                    row.style.display = '';
                } else if (filter === 'with' && hasExplanation) {
                    row.style.display = '';
                } else if (filter === 'without' && !hasExplanation) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            }
        }

        // Close modal when clicking outside of it
        window.onclick = function(event) {
            var modal = document.getElementById('editModal');
            if (event.target == modal) {
                closeEditModal();
            }
        }
    </script>
</body>
</html>

